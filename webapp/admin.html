<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>ĞĞ´Ğ¼Ğ¸Ğ½ â€” Ğ”Ğ¾ÑÑ‚ÑƒĞ¿</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --tg-bg:        var(--tg-theme-bg-color, #ffffff);
      --tg-secondary: var(--tg-theme-secondary-bg-color, #f4f4f5);
      --tg-text:      var(--tg-theme-text-color, #111111);
      --tg-hint:      var(--tg-theme-hint-color, #6b7280);
      --tg-link:      var(--tg-theme-link-color, #2563eb);
      --tg-btn:       var(--tg-theme-button-color, #2563eb);
      --tg-btn-text:  var(--tg-theme-button-text-color, #ffffff);
      --radius: 12px;
      --shadow: 0 1px 3px rgba(0,0,0,.10), 0 1px 2px rgba(0,0,0,.06);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: var(--tg-secondary);
      color: var(--tg-text);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      font-size: 14px;
      min-height: 100dvh;
      padding-bottom: env(safe-area-inset-bottom, 24px);
    }

    .header {
      background: var(--tg-btn);
      color: var(--tg-btn-text);
      padding: 14px 16px 12px;
      position: sticky; top: 0; z-index: 100;
    }
    .header h1 { font-size: 15px; font-weight: 700; }
    .header p  { font-size: 12px; opacity: .82; margin-top: 2px; }

    .page { padding: 14px; display: flex; flex-direction: column; gap: 14px; }

    .card {
      background: var(--tg-bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    .card-title {
      font-size: 11px; font-weight: 700;
      color: var(--tg-hint); text-transform: uppercase; letter-spacing: .05em;
      padding: 14px 16px 0;
    }

    /* Token */
    .token-row { display: flex; gap: 8px; align-items: center; padding: 10px 16px; }
    .token-row input {
      flex: 1; border: 1.5px solid color-mix(in srgb,var(--tg-hint) 25%,transparent);
      border-radius: 8px; padding: 8px 12px; font-size: 13px;
      background: var(--tg-secondary); color: var(--tg-text); font-family: monospace;
    }
    .token-row input:focus { outline: none; border-color: var(--tg-btn); }
    .token-hint { font-size: 11px; color: var(--tg-hint); padding: 0 16px 12px; line-height: 1.5; }
    .token-hint a { color: var(--tg-link); }

    /* Add user */
    .add-form { padding: 10px 16px 14px; display: flex; flex-direction: column; gap: 8px; }
    .add-form input {
      border: 1.5px solid color-mix(in srgb,var(--tg-hint) 25%,transparent);
      border-radius: 8px; padding: 9px 12px; font-size: 14px;
      background: var(--tg-secondary); color: var(--tg-text); width: 100%;
    }
    .add-form input:focus { outline: none; border-color: var(--tg-btn); }
    .add-form input::placeholder { color: var(--tg-hint); }
    .add-row { display: flex; gap: 8px; }
    .add-row input { font-family: monospace; letter-spacing: .05em; }

    /* Buttons */
    .btn {
      border: none; border-radius: 8px; padding: 9px 14px;
      font-size: 13px; font-weight: 600; cursor: pointer;
      transition: opacity .15s; white-space: nowrap; flex-shrink: 0;
    }
    .btn:active { opacity: .7; }
    .btn-primary { background: var(--tg-btn); color: var(--tg-btn-text); }
    .btn-ghost   { background: color-mix(in srgb,var(--tg-hint) 12%,transparent); color: var(--tg-text); }
    .btn-danger  { background: #fee2e2; color: #dc2626; }
    .btn-success { background: #dcfce7; color: #16a34a; }
    .btn-sm      { padding: 6px 10px; font-size: 12px; border-radius: 6px; }

    /* User list */
    .user-list { padding-bottom: 6px; }
    .user-item {
      display: flex; align-items: center; justify-content: space-between;
      padding: 10px 16px;
      border-top: 1px solid color-mix(in srgb,var(--tg-hint) 12%,transparent);
    }
    .user-item:first-child { border-top: none; }
    .user-left { display: flex; align-items: center; gap: 10px; min-width: 0; }
    .avatar {
      width: 34px; height: 34px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 13px; font-weight: 700; flex-shrink: 0;
    }
    .avatar-active   { background: #dbeafe; color: #1d4ed8; }
    .avatar-blocked  { background: #fee2e2; color: #dc2626; }
    .user-label { font-size: 14px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .user-code  { font-size: 11px; color: var(--tg-hint); font-family: monospace; letter-spacing: .05em; }
    .user-blocked-badge {
      font-size: 10px; font-weight: 700; color: #dc2626;
      background: #fee2e2; border-radius: 4px; padding: 1px 5px; margin-left: 6px;
    }
    .user-actions { display: flex; gap: 6px; flex-shrink: 0; margin-left: 8px; }

    .code-display {
      font-family: monospace; font-size: 15px; font-weight: 700;
      letter-spacing: .1em; color: var(--tg-btn);
      background: color-mix(in srgb,var(--tg-btn) 10%,transparent);
      padding: 10px 16px; border-radius: 8px; margin: 0 16px 14px;
      display: flex; align-items: center; justify-content: space-between;
    }

    .empty { text-align: center; padding: 24px 16px; color: var(--tg-hint); font-size: 13px; }
    .loading-text { text-align: center; padding: 20px; color: var(--tg-hint); font-size: 13px; }

    .toast {
      position: fixed; bottom: calc(env(safe-area-inset-bottom,16px) + 12px);
      left: 50%; transform: translateX(-50%) translateY(80px);
      background: #1e293b; color: #fff; padding: 10px 18px;
      border-radius: 24px; font-size: 13px; font-weight: 500;
      z-index: 9999; transition: transform .25s, opacity .25s;
      opacity: 0; white-space: nowrap; max-width: 90vw;
    }
    .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
    .toast.error { background: #dc2626; }

    #accessDenied {
      display: none; position: fixed; inset: 0; z-index: 9999;
      background: var(--tg-secondary); flex-direction: column;
      align-items: center; justify-content: center; padding: 32px; text-align: center;
    }
    #accessDenied h2 { font-size: 18px; font-weight: 700; margin: 16px 0 8px; }
    #accessDenied p  { font-size: 14px; color: var(--tg-hint); }
  </style>
</head>
<body>

<div class="header">
  <h1>âš™ï¸ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ¾Ğ¼</h1>
  <p id="adminName">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°â€¦</p>
</div>

<div class="page" id="mainPage" style="display:none">

  <!-- GitHub Token -->
  <div class="card">
    <div class="card-title">GitHub Token</div>
    <div class="token-row">
      <input type="password" id="tokenInput" placeholder="ghp_xxxxxxxxxxxx" autocomplete="off" />
      <button class="btn btn-primary" onclick="saveToken()">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
    </div>
    <div class="token-hint">
      Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ½Ğ° <a href="https://github.com/settings/tokens/new" target="_blank">github.com/settings/tokens</a>
      (scope: <strong>repo</strong>). Ğ¢Ğ¾ĞºĞµĞ½ Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ° ÑÑ‚Ğ¾Ğ¼ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğµ.
    </div>
  </div>

  <!-- Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ -->
  <div class="card">
    <div class="card-title">Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ</div>
    <div class="add-form">
      <input type="text" id="newLabel" placeholder="Ğ˜Ğ¼Ñ / Ğ¤Ğ˜Ğ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ"
             autocorrect="off" spellcheck="false" />
      <div class="add-row">
        <input type="text" id="newCode" placeholder="ĞšĞ¾Ğ´ (Ğ°Ğ²Ñ‚Ğ¾)" readonly
               autocomplete="off" autocorrect="off" autocapitalize="none" />
        <button class="btn btn-ghost" onclick="genCode()" title="Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ¾Ğ´">ğŸ”„</button>
        <button class="btn btn-primary" onclick="addUser()">Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ</button>
      </div>
    </div>
  </div>

  <!-- Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ -->
  <div class="card">
    <div class="card-title">ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸</div>
    <div class="user-list" id="userList">
      <div class="loading-text">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°â€¦</div>
    </div>
  </div>

</div>

<!-- Ğ­ĞºÑ€Ğ°Ğ½ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ¸ -->
<div id="accessDenied">
  <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="var(--tg-hint)" stroke-width="1.5">
    <rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>
  </svg>
  <h2>ĞĞµÑ‚ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ°</h2>
  <p>Ğ­Ñ‚Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ° Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ°.</p>
</div>

<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ADMIN_USERNAME = "Eveningwint";          // Ğ±ĞµĞ· @
const GITHUB_OWNER   = "oneclickrar-tech";
const GITHUB_REPO    = "road-app";
const USERS_FILE     = "users.json";
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const tg = window.Telegram?.WebApp;
if (tg) { tg.ready(); tg.expand(); }

const API_BASE = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${USERS_FILE}`;

let currentUsers = [];
let currentSha   = "";
let toastTimer   = null;

// â”€â”€ Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(async () => {
  const username = (tg?.initDataUnsafe?.user?.username || "").toLowerCase().trim();
  document.getElementById("adminName").textContent =
    username ? `@${username}` : "ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ğ¾ Ğ²Ğ½Ğµ Telegram";

  const isAdmin = !username || username === ADMIN_USERNAME.toLowerCase();
  if (!isAdmin) {
    document.getElementById("accessDenied").style.display = "flex";
    return;
  }

  document.getElementById("mainPage").style.display = "flex";

  const saved = localStorage.getItem("gh_admin_token");
  if (saved) document.getElementById("tokenInput").value = saved;

  genCode();
  await loadUsers();
})();

// â”€â”€ GitHub token â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getToken() { return document.getElementById("tokenInput").value.trim(); }
function saveToken() {
  const t = getToken();
  if (!t) { showToast("Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ñ‚Ğ¾ĞºĞµĞ½", true); return; }
  localStorage.setItem("gh_admin_token", t);
  showToast("Ğ¢Ğ¾ĞºĞµĞ½ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½");
}

// â”€â”€ Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ĞºĞ¾Ğ´Ğ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function genCode() {
  const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
  let code = "";
  for (let i = 0; i < 6; i++) code += chars[Math.floor(Math.random() * chars.length)];
  document.getElementById("newCode").value = code;
}

// â”€â”€ Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸Ğ· GitHub â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadUsers() {
  document.getElementById("userList").innerHTML = '<div class="loading-text">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°â€¦</div>';
  try {
    const res = await fetch(API_BASE, {
      headers: {
        "Accept": "application/vnd.github+json",
        ...(getToken() ? { "Authorization": `Bearer ${getToken()}` } : {})
      }
    });
    if (!res.ok) throw new Error(`GitHub API: ${res.status}`);
    const data = await res.json();
    currentSha   = data.sha;
    const content = JSON.parse(atob(data.content.replace(/\n/g, "")));
    currentUsers  = content.users || [];
    renderUsers();
  } catch (e) {
    document.getElementById("userList").innerHTML =
      `<div class="loading-text">ĞÑˆĞ¸Ğ±ĞºĞ°: ${e.message}<br><small>ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ GitHub Token</small></div>`;
  }
}

// â”€â”€ Ğ ĞµĞ½Ğ´ĞµÑ€ ÑĞ¿Ğ¸ÑĞºĞ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderUsers() {
  const list = document.getElementById("userList");
  if (!currentUsers.length) {
    list.innerHTML = '<div class="empty">ĞĞµÑ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹. Ğ”Ğ¾Ğ±Ğ°Ğ²ÑŒÑ‚Ğµ Ğ¿ĞµÑ€Ğ²Ğ¾Ğ³Ğ¾ Ğ²Ñ‹ÑˆĞµ.</div>';
    return;
  }
  list.innerHTML = currentUsers.map((u, i) => {
    const initial = (u.label || u.code)[0].toUpperCase();
    const avatarClass = u.active ? "avatar-active" : "avatar-blocked";
    const blockedBadge = u.active ? "" : '<span class="user-blocked-badge">Ğ‘Ğ›ĞĞš</span>';
    return `
    <div class="user-item">
      <div class="user-left">
        <div class="avatar ${avatarClass}">${initial}</div>
        <div style="min-width:0">
          <div class="user-label">${escHtml(u.label || "â€”")}${blockedBadge}</div>
          <div class="user-code" data-copy="${escAttr(u.code)}" style="cursor:pointer" title="ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ">
            ğŸ”‘ ${escHtml(u.code)}
          </div>
        </div>
      </div>
      <div class="user-actions">
        <button class="btn btn-sm ${u.active ? "btn-danger" : "btn-success"}"
          onclick="toggleUser(${i})">
          ${u.active ? "Ğ‘Ğ»Ğ¾Ğº" : "Ğ Ğ°Ğ·Ğ±Ğ»Ğ¾Ğº"}
        </button>
        <button class="btn btn-sm btn-danger" onclick="removeUser(${i})">âœ•</button>
      </div>
    </div>`;
  }).join("");

  // ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ´Ğ° Ğ¿Ğ¾ ĞºĞ»Ğ¸ĞºÑƒ
  list.querySelectorAll("[data-copy]").forEach(el => {
    el.addEventListener("click", () => {
      const text = el.dataset.copy;
      if (navigator.clipboard?.writeText) {
        navigator.clipboard.writeText(text).then(() => showToast(`Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½: ${text}`));
      } else {
        const ta = document.createElement("textarea");
        ta.value = text;
        ta.style.cssText = "position:fixed;top:-9999px";
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        showToast(`Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½: ${text}`);
      }
    });
  });
}

// â”€â”€ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function addUser() {
  const label = document.getElementById("newLabel").value.trim();
  const code  = document.getElementById("newCode").value.trim();
  if (!label) { showToast("Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¸Ğ¼Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ", true); return; }
  if (!code)  { showToast("Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ ĞºĞ¾Ğ´", true); return; }
  if (currentUsers.find(u => u.code === code)) {
    showToast("Ğ¢Ğ°ĞºĞ¾Ğ¹ ĞºĞ¾Ğ´ ÑƒĞ¶Ğµ ĞµÑÑ‚ÑŒ, ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ½Ğ¾Ğ²Ñ‹Ğ¹", true); return;
  }

  currentUsers.push({ code, label, active: true });
  const ok = await saveUsers(`Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: ${label}`);
  if (ok) {
    document.getElementById("newLabel").value = "";
    genCode();
    renderUsers();
    showToast(`âœ“ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½: ${label} (ĞºĞ¾Ğ´: ${code})`);
  } else {
    currentUsers.pop();
  }
}

// â”€â”€ Ğ‘Ğ»Ğ¾Ğº / Ñ€Ğ°Ğ·Ğ±Ğ»Ğ¾Ğº â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function toggleUser(i) {
  const u = currentUsers[i];
  const prev = u.active;
  u.active = !u.active;
  const ok = await saveUsers(`${u.active ? "Ğ Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½" : "Ğ—Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½"}: ${u.label}`);
  if (ok) {
    renderUsers();
    showToast(u.active ? `Ğ Ğ°Ğ·Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½: ${u.label}` : `Ğ—Ğ°Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½: ${u.label}`);
  } else {
    u.active = prev;
  }
}

// â”€â”€ Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function removeUser(i) {
  const u = currentUsers[i];
  const removed = currentUsers.splice(i, 1)[0];
  const ok = await saveUsers(`Ğ£Ğ´Ğ°Ğ»Ñ‘Ğ½ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: ${u.label}`);
  if (ok) { renderUsers(); showToast(`Ğ£Ğ´Ğ°Ğ»Ñ‘Ğ½: ${u.label}`); }
  else    { currentUsers.splice(i, 0, removed); }
}

// â”€â”€ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ² GitHub â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function saveUsers(msg) {
  const token = getToken();
  if (!token) { showToast("Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚Ğµ GitHub Token Ğ²Ñ‹ÑˆĞµ", true); return false; }

  const body    = JSON.stringify({ users: currentUsers }, null, 2) + "\n";
  const encoded = btoa(unescape(encodeURIComponent(body)));

  try {
    const res = await fetch(API_BASE, {
      method: "PUT",
      headers: {
        "Accept":        "application/vnd.github+json",
        "Authorization": `Bearer ${token}`,
        "Content-Type":  "application/json",
      },
      body: JSON.stringify({ message: msg, content: encoded, sha: currentSha }),
    });
    if (!res.ok) { const e = await res.json(); throw new Error(e.message || res.status); }
    const data = await res.json();
    currentSha = data.content.sha;
    if (tg) tg.HapticFeedback?.notificationOccurred("success");
    return true;
  } catch (e) {
    showToast(`ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ: ${e.message}`, true);
    if (tg) tg.HapticFeedback?.notificationOccurred("error");
    return false;
  }
}

// â”€â”€ Ğ¢Ğ¾ÑÑ‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToast(msg, err = false) {
  const el = document.getElementById("toast");
  el.textContent = msg;
  el.className = "toast show" + (err ? " error" : "");
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => el.classList.remove("show"), 2400);
}
function escHtml(s) {
  return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");
}
function escAttr(s) {
  return String(s).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");
}
</script>
</body>
</html>
